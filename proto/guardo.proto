syntax = "proto3";

package guardian_agent;

option go_package = "guardianagent";

message OpenOp {
    string path = 1;
    int32 flags = 2;
    uint32 mode = 3;
}

message UnlinkOp {
    string path = 1;
    int32 flags = 2;
}

message AccessOp {
    string path = 1;
    uint32 mode = 2;
}

message Operation {
    oneof op {
        OpenOp open = 1;
        UnlinkOp unlink = 2;
        AccessOp access = 3;
    }
}

message CredentialRequest {
    Operation op = 1;
    Challenge challenge = 2;
}

message Credential {
    Operation op = 1;
    Challenge challenge = 2;
    bytes signer_nonce = 3;
    string signature_format = 4;
    bytes signature_key = 5;
    bytes signature = 6;
}

message CredentialResponse {
    enum Status {
        APPROVED = 0;
        DENIED = 1;
    }
    Status status = 1;
    Credential credential = 2;
}

message ChallengeRequest {}

message Challenge {
    bytes server_nonce = 1;
    string server_hostname = 2;
    repeated bytes server_public_keys = 3;
}

message ElevationRequest {
    Operation op = 1;
    Credential credential = 2;
}

message ElevationResponse {
    bool is_result_fd = 1;
    int32 result = 2;
}